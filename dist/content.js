function i(e,t){const o=document.querySelector(e);if(o)return t(o);const c=new MutationObserver(()=>{const n=document.querySelector(e);n&&(c.disconnect(),t(n))});c.observe(document.body,{childList:!0,subtree:!0})}function s(){const e=document.querySelector('meta[name="theme-color"]');return e?e.content.includes("255, 255, 255")?"light":"dark":"light"}function m(e){if(!document.querySelector('meta[name="theme-color"]'))return;let o=s();new MutationObserver(()=>{const n=s();n!==o&&(e.classList.remove(`fln-${o}`),e.classList.add(`fln-${n}`),o=n,console.log(`ğŸ¨ Theme changed to ${n}`))}).observe(document.head,{childList:!0,subtree:!0})}function p(e){const t=document.querySelector("video");t&&(t.defaultPlaybackRate=e,t.playbackRate=e,d(e),chrome.storage.sync.set({preferredSpeed:e}),console.log(`âœ… Set speed to ${e}x`))}function h(){const e=document.querySelector("video");if(!e||e.__flnRateListenerAttached)return;const t=()=>{const o=e.playbackRate;d(o),console.log(`ğŸ§ Playback speed changed to ${o}x`)};e.addEventListener("ratechange",t),e.__flnRateListenerAttached=!0,t()}function g(e=[1,2.5,3,3.5,4]){const t=document.createElement("div");t.id="fln-speed-controls",t.className="fln-speed-ui fln-loading";const o=s();return t.classList.add(`fln-${o}`),e.forEach(c=>{const n=document.createElement("button");n.textContent=`${c}x`,n.className="fln-speed-btn",n.addEventListener("click",()=>p(c)),t.appendChild(n)}),t}function d(e){document.querySelectorAll(".fln-speed-btn").forEach(o=>{const c=parseFloat(o.textContent.replace("x","")),n=Math.round(c*100)===Math.round(e*100);o.classList.toggle("active",n)})}function r(e){if(document.querySelector("#fln-speed-controls")||r._inProgress){console.debug("Injection skipped: already in progress or UI exists");return}r._inProgress=!0,chrome.storage.sync.get("customSpeeds",o=>{const c=o.customSpeeds??[1,2.5,3,3.5,4],n=g(c);e.parentElement.insertBefore(n,e),r._inProgress=!1,console.log("âœ… Injected speed control UI")})}function v(){chrome.storage.sync.get("preferredSpeed",e=>{const t=e.preferredSpeed??1,o=()=>{const n=document.querySelector("video");n&&(n.defaultPlaybackRate=t,n.playbackRate=t,h(),i("#above-the-fold #title",f=>{const l=document.querySelector("#fln-speed-controls");l&&l.remove(),r(f),i("#fln-speed-controls",a=>{d(t),a.classList.remove("fln-loading"),m(a)})}),console.log(`ğŸ¯ Applied playback speed: ${t}x`))};o();const c=new MutationObserver(()=>{const n=document.querySelector("video");n&&!n.__flnAlreadyHandled&&(n.__flnAlreadyHandled=!0,c.disconnect(),o())});c.observe(document.body,{childList:!0,subtree:!0})})}function u(){v()}u();window.addEventListener("yt-navigate-finish",()=>{console.log("ğŸ” Navigation detected"),u()});
