function d(e,n){const o=document.querySelector(e);if(o)return n(o);const c=new MutationObserver(()=>{const t=document.querySelector(e);t&&(c.disconnect(),n(t))});c.observe(document.body,{childList:!0,subtree:!0})}function r(){const e=document.querySelector('meta[name="theme-color"]');return e?e.content.includes("255, 255, 255")?"light":"dark":"light"}function u(e){if(!document.querySelector('meta[name="theme-color"]'))return;let o=r();new MutationObserver(()=>{const t=r();t!==o&&(e.classList.remove(`fln-${o}`),e.classList.add(`fln-${t}`),o=t,console.log(`ğŸ¨ Theme changed to ${t}`))}).observe(document.head,{childList:!0,subtree:!0})}function f(e){const n=document.querySelector("video");n&&(n.defaultPlaybackRate=e,n.playbackRate=e,s(e),chrome.storage.sync.set({preferredSpeed:e}),console.log(`âœ… Set speed to ${e}x`))}function m(){const e=document.querySelector("video");if(!e||e.__flnRateListenerAttached)return;const n=()=>{const o=e.playbackRate;s(o),console.log(`ğŸ§ Playback speed changed to ${o}x`)};e.addEventListener("ratechange",n),e.__flnRateListenerAttached=!0,n()}function p(e=[1,2.5,3,3.5,4]){const n=document.createElement("div");n.id="fln-speed-controls",n.className="fln-speed-ui fln-loading";const o=r();return n.classList.add(`fln-${o}`),e.forEach(c=>{const t=document.createElement("button");t.textContent=`${c}x`,t.className="fln-speed-btn",t.style.padding="6px 12px",t.style.cursor="pointer",t.style.background="white",t.style.color="black",t.style.border="none",t.style.borderRadius="4px",t.addEventListener("click",()=>f(c)),n.appendChild(t)}),n}function s(e){document.querySelectorAll(".fln-speed-btn").forEach(o=>{const c=parseFloat(o.textContent.replace("x","")),t=Math.round(c*100)===Math.round(e*100);o.classList.toggle("active",t)})}function h(e){if(document.querySelector("#fln-speed-controls"))return;const n=p();e.parentElement.insertBefore(n,e)}function b(){chrome.storage.sync.get("preferredSpeed",e=>{const n=e.preferredSpeed??1,o=()=>{const t=document.querySelector("video");t&&(t.defaultPlaybackRate=n,t.playbackRate=n,m(),d("#above-the-fold #title",i=>{h(i),d("#fln-speed-controls",l=>{s(n),l.classList.remove("fln-loading"),u(l)})}),console.log(`ğŸ¯ Applied playback speed: ${n}x`))};o();const c=new MutationObserver(()=>{const t=document.querySelector("video");t&&!t.__flnAlreadyHandled&&(t.__flnAlreadyHandled=!0,c.disconnect(),o())});c.observe(document.body,{childList:!0,subtree:!0})})}function a(){b()}a();window.addEventListener("yt-navigate-finish",()=>{console.log("ğŸ” Navigation detected"),a()});
